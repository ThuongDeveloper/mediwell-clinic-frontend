<html  xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<div th:replace="~{admin/layout/layoutfixbug :: head}"></div>


<body class="nav-md">
<div class="container body">
    <div class="main_container">
        <div th:replace="~{admin/layout/slidebarfixbug :: slidebarAdmin}"></div>
        <div class="top_nav">
            <div th:replace="~{admin/layout/header :: div}"></div>
        </div>
        <!-- Content -->

        <div class="right_col" role="main">
          
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="x_panel">
                        <div class="x_content">
                            <form th:action="@{/admin/donthuoc/create}" th:object="${donthuoc}" method="post">
                                 <h1 style="text-align: center">Create Medication Invoice</h1>
                                <div class=" form-group">
                                    <button class="btn btn-secondary" type="button" id="addButton">Thêm</button>
                                    <div id="boxes"></div>
                                </div>
                                <div class="form-group">
                                    <div    >
                                        <input type="submit" value="Create" class="btn btn-primary" />
                                        <input type="reset" value="Reset" class="btn btn-success" />
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ... -->
    </div>

    <!-- ... -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const addButton = document.getElementById('addButton');
        const boxesContainer = document.getElementById('boxes');

        let boxCount = 0;

        addButton.addEventListener('click', () => {
            const box = createBox();
            boxesContainer.appendChild(box);
        });

        function createBox() {
            const box = document.createElement('div');
            box.className = "row my-2";
           
       
            
            const colRow1 = document.createElement('div');
            colRow1.className = "col-4";
             const colRow2 = document.createElement('div');
            colRow2.className = "col";
             const colRow3 = document.createElement('div');
            colRow3.className = "col";
             const colRow4 = document.createElement('div');
            colRow4.className = "col";
            const colRowRemove = document.createElement('div');
            colRowRemove.style="display:flex;align-items:end;";
            colRowRemove.className = "col-1";
           
            
            const selectLabel = document.createElement('label');
            selectLabel.textContent = 'Select drug';
            colRow1.appendChild(selectLabel);         
            const select = createSelect();
            select.className ='form-control';
            colRow1.appendChild(select);
            
            box.appendChild(colRow1);
            //Row 1
            
            const priceLabel = document.createElement('label');
            priceLabel.textContent = 'Price';       
            colRow2.appendChild(priceLabel);           
            const input = createInput(); 
            input.className ='form-control';
            colRow2.appendChild(input);             
            box.appendChild(colRow2);
            //Row 2
            
            const quantityLabel = document.createElement('label');
            quantityLabel.textContent = 'Quantity';
            colRow3.appendChild(quantityLabel);
            const quantityInput = createQuantityInput();
            quantityInput.className ='form-control';
            colRow3.appendChild(quantityInput);
            box.appendChild(colRow3);
            //Row 3 
              const removeButton = createRemoveButton();
    removeButton.addEventListener('click', () => {
        boxesContainer.removeChild(box);
    });
    colRowRemove.appendChild(removeButton);
    box.appendChild(colRowRemove);
    
            const result = document.createElement('div');
            result.classList.add('result');

            select.addEventListener('change', async () => {
                const selectedOption = select.options[select.selectedIndex];
                input.value = selectedOption.getAttribute('data-price');
            });

            box.appendChild(result);

            return box;
        }

        async function fetchThuocData() {
            try {
                const response = await axios.get('http://localhost:8888/api/thuoc');
                return response.data;
            } catch (error) {
                console.error('Lỗi khi tải dữ liệu thuốc:', error);
                return [];
            }
        }

        async function populateDropdown(select) {
            const thuocData = await fetchThuocData();

            thuocData.forEach(thuoc => {
                const option = createOption(thuoc.id, thuoc.name, thuoc.price);
                select.appendChild(option);
            });
        }

        function createSelect() {
            const select = document.createElement('select');
            select.classList.add('dropdown');
            select.name = 'thuocID';
            populateDropdown(select);

            return select;
        }

        function createOption(id, name, price) {
            const option = document.createElement('option');
            option.value = id;
                
            option.textContent = name;
            option.setAttribute('data-price', price);
            return option;
        }

        function createInput() {
            const input = document.createElement('input');
            input.type = 'text';        
            input.name = 'price';
            input.setAttribute('readonly', true); 
            input.classList.add('input');
            return input;
        }

        function createQuantityInput() {
            const quantityInput = document.createElement('input');
            quantityInput.type = 'number';
            quantityInput.name = 'quantity';
            quantityInput.classList.add('input');
            return quantityInput;
        }
        function createRemoveButton() {
    const removeButton = document.createElement('button');
    removeButton.textContent = '-';
    removeButton.className = 'btn btn-danger';
    removeButton.style ="margin-bottom:0";
    return removeButton;
}

    </script>
    <!-- Content -->
    <div th:replace="~{admin/layout/footer :: footer}"></div>
</div>

<div th:replace="~{admin/layout/layoutfixbug :: body}"></div>

</body>
</html>
